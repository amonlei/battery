<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="css/jquery.mobile-1.4.2.min.css">
        <link rel="stylesheet" href="css/app.css">
        <link rel="stylesheet" href="css/batteries.css">
        <script type="text/javascript" src="phonegap.js"></script>
        <script src="js/jquery.js"></script>
        <script type="text/javascript" src='js/jquery.loadTemplate-1.4.4.min.js'></script>
        <script type="text/javascript" src='js/jquery.xml2json.js'></script>
        <script type="text/javascript" src='js/jquery.storageapi.min.js'></script>
        <script type="text/javascript" src='js/app.js'></script>
        <script type="text/javascript" src='js/md5.js'></script>
        <script src="js/jquery.mobile-1.4.2.min.js"></script>           
        <title>调试页面</title>
    </head>
    <body>
        <div data-role="page" data-control-title="Home" id="show">
            <div data-theme="a" data-role="header">
                <h1 class="ui-title">
                    1号电池状态
                </h1>
                <a href="setting.html" data-iconpos="left" class="ui-btn ui-icon-bullets ui-btn-icon-notext ui-corner-all ui-btn-right" rel='external'>
                    设置
                </a>
            </div>
            <div role="main" class="ui-content">
                <div style="" data-controltype="image">
                    <img style="width: 128px; height: 128px" src="icon.png">
                </div>
                <div id='status' class="ui-field-contain">
                    <fieldset data-role="controlgroup" data-type="horizontal">
                        <legend>当前状态</legend>
                        <input name="status" id="status_1" value="空闲" checked="checked" type="radio">
                        <label for="status_1" class='status_label1'>空闲</label>
                        <input name="status" id="status_2" value="繁忙" type="radio">
                        <label for="status_2" class='status_label2'>繁忙</label>
                    </fieldset>
                </div>
                <ul data-role="listview" data-div   ider-theme="a" data-inset="true">
                    <li data-role="list-divider" role="heading">                    
                        联系电话
                    </li>
                    <li>
                        <a id='link_mobile' href="setting.html#edit"  rel='external' data-transition="slide" class='ui-icon-edit'> 
                            读取中...
                        </a>
                    </li>
                    <li data-role="list-divider" role="heading">
                        服务范围
                    </li>
                    <li>
                        <a id='clserver' href="setting.html#edit"  rel='external' class='ui-icon-edit'>全国</a>
                    </li>
                </ul>
                <ul data-role="listview" data-div   ider-theme="a" data-inset="true">
                    <li data-role="list-divider" role="heading">
                        车身长度
                    </li>
                    <li>
                        <a id='clLength' href="setting.html#edit"  rel='external' data-transition="slide" class='ui-icon-edit'> 
                            读取中...
                        </a> 
                    </li>
                </ul>   
                <a class='ui-btn ui-corner-all ui-btn-icon-left ui-icon-grid' href="setting.html" rel='external'>
                    更多设置......
                </a>      
                <a href="#login_out_confirm" data-rel="popup" data-position-to="window" data-transition="pop" class="ui-btn ui-corner-all ui-btn-icon-left ui-icon-power">我要退出登录</a>
                <div data-role="popup" id="login_out_confirm"  data-dismissible="false" style="max-width:400px;">
                    <div data-role="header" data-theme="a">
                    <h1>即将离线?</h1>
                    </div>
                    <div role="main" class="ui-content">
                        <h3 class="ui-title">您确认要让自己下线，导致货主们无法找到您吗?</h3>
                    <p>当然，休息下也是可以的，只要重新登录就恢复了.</p>
                        <a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-icon-left ui-icon-check" data-rel="back">不了，我要继续在线</a>
                        <a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-icon-left ui-icon-delete" data-rel="back" data-transition="flow" id='login_out'>是的，我要下线</a>
                    </div>
                </div>
            </div>
            <script type="text/javascript">
                var on_success = function(position) {                    
                    log('显示车辆所在地址')
                    try{
                        $current_address(position,function(address,position) {
                            if(address.length > 0) {
                                $('#current_address').html(address);    
                            } else {
                                $('#current_address').html(position.coords.longitude+","+position.coords.latitude);
                            }                            
                            log('同步车辆位置:' + position.coords.longitude+","+position.coords.latitude);
                            $.get("http://mytusi.com/proxys/userjwd/lorrynet", {
                                    username: $current_user.username,
                                    md5uname: $current_user.md5uname,
                                    jingdu: position.coords.longitude,
                                    weidu:position.coords.latitude,
                                    address: $('#current_address').html()
                                },function(xml) {
                                    var result =  $.xml2json(xml)
                                    if(result == 'jwdsucceed') {
                                        log('同步车辆位置成功')
                                    } else {
                                        log('同步车辆位置失败')
                                    }
                            })
                        })    
                    }catch(e) {
                        log('显示车辆所在地址失败：' + e);
                        $('#current_address').html('系统繁忙，暂时无法获取地址信息，请稍后');  
                    }                                        
                }

                function on_error(error) {                        
                    log('获取车辆位置失败：' + '  code: '    + error.code    + '\n' +
                          'message: ' + error.message + '\n');
                    $('#current_address').html('系统繁忙，暂时无法获取车辆位置，请稍后');  
                }

                $gps(on_success,on_error);

                $('#login_out').on('tap',function() {
                    $loading();
                    $.get("http://www.lorrynet.cn/anz/exitlogin.php?", {
                            username: $current_user.username,
                            md5uname: $current_user.md5uname,
                        }, function(xml) {
                            $hide_loading();
                            var result =  $.xml2json(xml)
                            if(result == 'exitloginsucceed') {
                                $db.remove('sessions.current');
                                window.location.href = 'sessions.html';
                            } else {
                                alert($en2zh[result])
                            }

                    })
                })
            </script>
        </div>
    </body>
</html>    